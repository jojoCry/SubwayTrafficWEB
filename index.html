<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet"/>
		<script src="https://lib.sinaapp.com/js/jquery/2.0.2/jquery-2.0.2.min.js"></script>
		<style>
			body{
				background-color: #D0D0D0;
			}
			.appTitle{
				font:italic 1em Georgia, serif;
				font-size: 300%;
				margin-top: 5%;
				color: #856363;
			}
			.mui-input-group{
				background-color: #FFFFFF;
			}
		</style>
	</head>
	<body>
		<div class="appTitle" align="center">
			SubwayTraffic
		</div>
		<form class="mui-input-group" style="margin-top: 10%">
			<div class="mui-input-row">
				<label>用户名</label>
			<input type="text" id="username" class="mui-input-clear" placeholder="请输入用户名">
			</div>
			<div class="mui-input-row">
				<label>密码</label>
				<input type="password" id="password" class="mui-input-password" placeholder="请输入密码">
			</div>
			<div class="mui-button-row">
				<button type="button" style="float: left; width: 30%;" id="register" class="mui-btn mui-btn-primary mui-btn-outlined" >注册</button>
				<button type="button" style="align-content: center; width: 30%;" id="login" class="mui-btn mui-btn-success mui-btn-outlined" >确认</button>
				<button type="button" style="float: right; width: 30%" id="changePwd" class="mui-btn mui-btn-warning mui-btn-outlined">修改密码</button>
			</div>
		</form>
	</body>
	<script type="text/javascript" charset="utf-8">
			mui.init();
			$("#login").click(function () {
				const uname = $("#username").val();
				const password = $("#password").val();
				if (mui.isEmptyObject(uname) || mui.isEmptyObject(password)) {
					mui.alert("用户名或密码为空", "message");
				} else {
					$.ajax({
						url: "http://192.168.0.105:9188/system/v1/login",
						type: "post",
						data: JSON.stringify({
							"username": uname,
							"password": password
						}),
						contentType: "application/json; charset=UTF-8",
						dataType: "json",
						success: function(response){
							mui.alert("欢迎登陆", "message");
							console.log(response.token);
							// window.location.href = "https://www.baidu.com";
						},
						error: function(response){
							const statusCode = JSON.stringify(response.status);
							if (statusCode === '403') {
								mui.alert("密码错误", "error");
							} else if (statusCode === '404' ) {
								mui.alert("找不到该用户", "error");
							}
						}
					});
				}
			});

			$("#changePwd").click(function () {
				window.location.href = "changePwd.html";
			});

			$("#register").click(function () {
				window.location.href = "register.html";
			});
	</script>
</html>